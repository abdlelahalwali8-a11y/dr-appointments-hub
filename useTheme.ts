import { useEffect, useState, useCallback } from 'react';\n\nexport type Theme = 'light' | 'dark' | 'system';\nexport type Direction = 'ltr' | 'rtl';\n\nexport interface ThemeState {\n  theme: Theme;\n  direction: Direction;\n  isDark: boolean;\n}\n\nconst THEME_STORAGE_KEY = 'dr-appointments-theme';\nconst DIRECTION_STORAGE_KEY = 'dr-appointments-direction';\n\nexport const useTheme = () => {\n  const [themeState, setThemeState] = useState<ThemeState>({\n    theme: 'system',\n    direction: 'rtl',\n    isDark: false,\n  });\n\n  // Initialize theme from localStorage\n  useEffect(() => {\n    const savedTheme = (localStorage.getItem(THEME_STORAGE_KEY) as Theme) || 'system';\n    const savedDirection = (localStorage.getItem(DIRECTION_STORAGE_KEY) as Direction) || 'rtl';\n\n    setThemeState({\n      theme: savedTheme,\n      direction: savedDirection,\n      isDark: getIsDark(savedTheme),\n    });\n\n    applyTheme(savedTheme);\n    applyDirection(savedDirection);\n  }, []);\n\n  // Listen to system theme changes\n  useEffect(() => {\n    if (themeState.theme !== 'system') return;\n\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = (e: MediaQueryListEvent) => {\n      const isDark = e.matches;\n      setThemeState((prev) => ({ ...prev, isDark }));\n      applyTheme('system');\n    };\n\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, [themeState.theme]);\n\n  const getIsDark = (theme: Theme): boolean => {\n    if (theme === 'dark') return true;\n    if (theme === 'light') return false;\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n  };\n\n  const applyTheme = (theme: Theme) => {\n    const isDark = getIsDark(theme);\n    const root = document.documentElement;\n\n    if (isDark) {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n\n    localStorage.setItem(THEME_STORAGE_KEY, theme);\n  };\n\n  const applyDirection = (direction: Direction) => {\n    const root = document.documentElement;\n    root.setAttribute('dir', direction);\n    root.setAttribute('lang', direction === 'rtl' ? 'ar' : 'en');\n    document.body.style.direction = direction;\n    localStorage.setItem(DIRECTION_STORAGE_KEY, direction);\n  };\n\n  const setTheme = useCallback((theme: Theme) => {\n    setThemeState((prev) => ({\n      ...prev,\n      theme,\n      isDark: getIsDark(theme),\n    }));\n    applyTheme(theme);\n  }, []);\n\n  const setDirection = useCallback((direction: Direction) => {\n    setThemeState((prev) => ({ ...prev, direction }));\n    applyDirection(direction);\n  }, []);\n\n  const toggleTheme = useCallback(() => {\n    setTheme(themeState.theme === 'dark' ? 'light' : 'dark');\n  }, [themeState.theme, setTheme]);\n\n  const toggleDirection = useCallback(() => {\n    setDirection(themeState.direction === 'rtl' ? 'ltr' : 'rtl');\n  }, [themeState.direction, setDirection]);\n\n  return {\n    ...themeState,\n    setTheme,\n    setDirection,\n    toggleTheme,\n    toggleDirection,\n  };\n};\n\nexport default useTheme;\n
